# 概述

## 互联网组成

### 边缘部分

* 由所有连接在互联网上的主机组成，是用户直接使用的，用来进行通信和资源共享
* C/S 方式
  * 客户作为请求方，向服务器请求数据获得服务，服务器作为服务提供方
  * 二者都需要使用网络核心所提供的服务
  * 客户程序需要知道服务器的地址，服务器被动等待接收来自各地客户的通信请求
* P2P 方式
  * 对等连接。两台主机在通信时并不区分谁是服务提供方，只要两台主机都运行了对等连接软件，就可以进行平等的连接通信
  * 双方都可以下载对方存在磁盘中的共享数据文档
  * 一种特殊的CS服务方式，既是客户也是服务器
  * 支持大量（上百万个）对等用户同时工作

### 核心部分

* 由大量网络和连接这些网络的路由器组成。为边缘部分提供服务，提供连通性和交换

* 最复杂的部分，向边缘中的大量主机提供连通性，使其中的任何一台主机都能够向其他主机通信

* 起特殊作用的是路由器，是一种专用计算器。实现分组交换的关键组件，任务是转发收到的分组

* 电路交换（switch：切换 ???）
  * 替换了之前很多部电话彼此两两相连接的方式，引入了交换机
  * 交换机将这些电话连接起来，每一部电话只连接到交换机上，彼此之间可以方便地通信
  * 交换机之间也可以相互连接，依此可形成庞大的电信和网络
  * 电路交换：经过建立连接（占用通信资源）、通话（一直占用通信资源）、释放连接（归还通信资源）三个步骤的交换方式
  * 在通话的全部时间内，通话的两个用户始终占用端到端的通信资源
  * 线路传输效率较低，计算机数据突发式的出现在传输线路上，通信线路大部分时间都是空闲的

* 分组交换
  * 采用存储转发技术。把一个报文划分为几个分组后再进行传送，发送的整块数据为报文 message。发送前，将报文划分成较小的等长的数据段，并在此数据段前加上必要的控制信息作为首部，就构成了分组，或称之为包。即：分组=数据段+首部
  * 分组是传输的数据单元
  * 路由器用于转发这些分组，即进行分组交换的。路由器收到一个分组时，先暂存一下，检查首部，查找转发表，按照首部中的目标地址找到合适的接口转发出去，把分组交给下一个路由器，以这样的存储转发的方式，把分组交付给最终的目的主机
  * 路由器相当于快递路上不同的中转站，实现资源数据的一步步转移，直至转交给目标地址
  * 路由器必须经常交换彼此掌握的路由信息，以便创建和动态维护路由器中的转发表
  * 分组在各个路由器转发时需要排队，会造成延时；分组时携带的控制信息也有额外的开销；整个分组交换网还需要专门的管理和控制机制
  * 电路交换：整个报文的比特流连续地从源点直达终点，好像在一个管道中传达
  * 报文交换：整个报文先传到相邻节点，全部存储下来后查找转发表，转发到下一个节点
  * 分组交换：整个报文的一部分即单个分组传送到相邻节点，存储下来后查找转发表，转发到下一个节点

### 网络的性能

* 速率：数据的传输速率，或称为数据率，基本单位是比特每秒（bit/s）。计算机发送的信号都是数字形式的，比特即二进制数字0和1
* 带宽：表示网络中某通道传输数据的能力。单位时间内通过某信道的最高数据率，基本单位就是数据率的单位 bit/s
* 吞吐量：单位时间内通过某个网络信道或者接口的实际数据量

### 具有五层协议的体系结构

* OSI 是七层协议体系结构：物理层、数据链路层、网络层、运输层、会话层、表示层、应用层
* TCP/IP 是四层协议体系结构：网络接口层、网际层 IP、运输层（TCP 或者 UDP）、应用层
* 五层协议的体系结构：物理层、数据链路层、网络层、运输层、应用层。是四层和七层的折中
* 应用层：应用层协议是应用进程间通信和交互的规则：HTTP、SMTP、FTP 等协议，应用层交互的数据单元是报文
* 运输层：负责向两台主机进程之间的通信提供通用的数据传输服务。应用层利用该服务传送应用层报文
  * 传输控制协议 TCP：提供面向连接的、可靠的数据传输服务，其数据传输的单位是报文段
  * 用户数据报协议 UDP：提供无连接的、尽最大努力的数据传输服务（不保证数据传输的可靠性），其数据传输的基本单位是用户数据报
* 网络层：负责为分组交换网上的不同主机提供通信服务。发送数据时，网络层把运输层产生的报文段或者用户数据报封装成分组或者包进行传送。又称为网际层、IP 层。使用 IP 协议
* 数据链路层：即链路层。两台主机之间的数据传输，是一段一段在链路上传送的。数据在相邻节点之间传输时，数据链路层将网络层交下来的 IP 数据报组装成帧，相邻节点间的链路上传送帧，每一帧包括数据和必要的控制信息
* 物理层：在此层上传输的数据的单位是比特，0或者1

# 物理层

## 基本概念

* 物理层考虑的是如何在连接计算机上的传输媒体上传输数据比特流，而非具体的传输媒体

## 数据通信

* 原系统（发送端）、传输系统（传输网络）、目的系统（接收端）
* 通信的目的是发送消息 message，数据 data 是实际的发送消息实体
* 信道 channel：向某一个方向发送信息的媒体。一条通信电路包含一条发送信道和一条接收的信道
* 单向通信：即单工通信。只有一个方向的通信而没有交互响应，如广播。只需要一条信道
* 双向交替通信：即半双工通信。通信的双方都可以发送信息，但是不能同时发送或者接收消息。只能一方发送另一方接收，然后再反过来。需要两条信道，每个方向各一条
* 双向同时通信：即全双工通信。通信双方可以同时发送和接收消息。需要两条信道，每个方向各一条
* 调制：来自信源的信号称之为基带信号，其中含有很多低频成分，为解决某些信道无法传输该种低频信号，需要对基带信号进行调制
* 信道的极限容量：信道不能以任意高的速率进行传送。信号在信道上传送时，会产生失真，接收端需要从失真的信号中识别和还原原来的信号。传送速率越高、传送距离越远就会导致失真越严重

## 传输媒体

* 是数据传输系统中在发送系统和接收系统之间的物理通路
* 导引型传输媒体
  * 电磁波被导引沿着固定媒体（铜线或者光纤）传播
* 非导引型传输媒体
  * 即为自由空间，通过该种介质进行的传输称之为无线传输

### 导引型传输媒体

* 双绞线：将两根相互绝缘的铜导线并排放在一起，通过规则的方法绞合在一起。减少了二者之间的电磁干扰
* 同轴电缆：由内导体铜质芯线、绝缘体、网状编织的外导体屏蔽层以及塑料外层构成。用于较高速率的数据传输
* 光缆：光纤通信利用光导纤维传递光脉冲进行通信。一个光纤通信系统传输带宽远大于其他传输媒体的带宽
  * 原理：光纤作为传输媒体。光源作为发送端，可以采用发光二极管或者半导体激光器，在脉冲的作用下产生光脉冲；接受端采用光电二极管做成光检测器，检测到光脉冲时还原出电脉冲

### 非导引型传输媒体

* 导引型传输媒体无法实施时，采用非导引型传输媒体。
* 无线信道进行信息传输是运动中通信的唯一手段，如移动电话通信而非固定电话通信
* 卫星通信：传播延时较高

## 信道复用技术

* 在发送端先经过复用器，将原本经过不同信道的信号，改为共享一个信道进行通信，在接收端再使用分用器，把合起来的信息分别送到相应的终点
* 要求共享信道的带宽要大于单独的信道
* 频分复用
  * 用户在分配到一定的频带后，在通信过程中会一直占用该频带
  * 频分复用的所有用户在同样的时间占用不同的频率带宽资源
* 时分复用
  * 将时间划分为一段段等长的时分复用帧，每一个时分复用的用户在每一个帧中占用固定序号的时隙
  * 时分复用的用户在不同时间占用同样的频率带宽
* 统计时分复用
  * 改进的时分复用技术，提高信道的利用率
* 波分复用
  * 即光的频分复用。在一根光纤上同时传输多个频率很接近的光载波信号
* 码分复用
  * 每人用户可以在同样的是时间使用同样的频带进行通信，各用户使用不同的码型，彼此之间不会干扰

# 数据链路层

* 使用的信道主要有点对点信道（一对一）和广播信道（一对多）
* 数据的流动可能需要经过多个不同的路由器，路由器在转发分组时使用的协议栈只有物理层、数据链路层、网络层这三层。数据进入路由器后，要先从物理层上到网络层，在转发表中找到下一跳的地址后，再下到物理层转发出去

## 点对点信道的数据链路层

### 数据链路

* 链路：从一个结点到相邻结点的物理路线（有线或者无线），中间没有其他交换结点，是一条路径的组成部分
* 数据链路：在一条线路上传输数据时，除了一条必须的物理线路外，还必须要有一些通信协议来控制这些数据的传输，将实现这些协议的硬件和软件加到链路上就构成了数据链路

### 帧

* 点对点信道的数据链路层的协议数据单元
* 数据链路层把网络成交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据取出并上交给网络层
* 网络层协议数据单元就是 IP 数据报（数据报、分组、包）

### 通信时的主要步骤

* 当仅考虑数据链路层时
* 结点A的数据链路层把网络层交下来的IP数据报添加到首部和尾部封装成帧
* 结点A把封装好的帧发送给结点B的数据链路层
* 若结点B的数据链路层接收到的帧无差错，则从接受到的帧中取出IP数据报交给上面的网络层，否则丢弃该帧数据

## 点对点协议

* PPP，是数据链路层协议
* 三个组成部分
  * 一个将IP数据报封装到串行链路的方法。IP数据报在PPP帧中就是其信息部分
  * 一个用来建立、配置和测试数据链路连接的链路控制协议LCP
  * 一套网络控制协议NCP

### PPP协议的帧格式

* 首部、IP数据报（信息部分）、尾部

### PPP协议的工作状态

* 当用户拨号接入到ISP中后，就建立了一条从用户个人电脑到ISP的物理连接
* 此时，用户个人电脑向ISP发送一些列的链路控制协议分组，以便建立LCP连接。这些分组及其响应选择了将要使用的一些PPP参数
* 网络层配置，网络控制协议NCP给新接入的用户个人电脑分配一个临时的IP地址
* 用户个人电脑就成为了互联网的一个有IP地址的主机了
* 当通信完毕时，NCP释放网络层连接，收回原来分配出去的IP地址。然后，LCP释放数据链路层连接，最后释放物理层的连接

## 广播信道的数据链路层

### 局域网的数据链路层

* 网络为一个单位所有，且地理范围和站点数目均有限
* 具有广播功能，从一个站点可以方便地访问全网。局域网上的主机可共享连接在局域网上的各种硬件资源和软件资源

# 网络层

## 网络层提供的服务

* 网络层只向上提供简单灵活的、无连接的、尽最大努力交付的数据报服务
* 数据报即分组
* 网络在发送分组时不需要先建立连接。每个分组独立发送，与其后的分组无关，不进行编号
* 网络层不提供服务质量的承诺。即所传送的分组可能出错、丢失、重复和失序等。使得网络中的路由器简单灵活廉价

## 网际协议 IP

* 主要讲解的是 IP 的第四个版本，即 IPv4。较新的版本为 IPv6
* 与 IP 协议配套使用的是其他三个协议
  * 地址解析协议 ARP
  * 网际控制报文协议 ICMP
  * 网际组管理协议 IGMP

### 虚拟互联网络

* 没有单一的网络可以满足用户的所有需求且网络技术不断发展。因此，需要市场上具有不同性能、不同网络协议的网络供不同用户使用
* 将网络互相连接袭来需要中间设备，这些中间设备分别在不同层中，对应有四种不同的中间设备
  * 物理层：转发器
  * 数据链路层：网桥或者桥接器
  * 网路层：路由器
  * 网络层：网关
* 许多台计算机网络通过一些路由器进行互联，这些互联的计算器使用相同的网际协议 IP，可以将其看成是一个虚拟的互联网络，即逻辑互联网络。在网络层上看起来是一个统一的网络，即 IP 网。若在该 IP 层上使用 TCP 协议，即为互联网

### 分类的IP地址

* IP 地址及其表示法
  * 是给互联网上的每一台主机或者路由器的每一个接口分配一个在全世界范围内是唯一的 32 位的标识符
* 分类的 IP 地址是将 IP 地址划分为若干个固定类，每一类地址都由两个固定长度的字段组成
  * 网络号：标识了主机或者路由器所连接到的网络，在整个互联网中是唯一的
  * 主机号：标志了该主机或者路由器。一台主机号在其之前的网络号所指明的网络范围内是唯一的
  * 故而，一个IP在整个互联网内是唯一的
* 分为 A、B、C、D、E 五类地址
* IP 地址是 32 位的二进制代码，为便于阅读，采用`点分十进制`记法，将由0和1组成的32位分为4组，每组8位，如 10000000 00001011 00000011 00011111，换成十进制之后为 128.11.3.31
* A 类地址：`网络号(0 + 其余7位) + 主机号(24位) `
  * 网络号占 1 个字节 8 位，只有 7 位可用，第一位已固定为 0
  * 可指派的网络号是 126 个，即 2^7 - 2
  * IP 地址中全0为 '这个 this'，是保留地址，意为本网络。减 1
  * 网络号为 127 ( 01111111 )保留作为本地软件环回测试本主机的进程之间的通信，再减 1
  * 主机号占 3 个字节，因此每一个 A 类网络中的最大主机数是 2^24 - 2
  * 全 0 的主机号，表示该 IP 地址的本主机所连接到的单个网络地址
  * 全 1 的主机号，表示该网络上的所有主机
  * IP 地址空间共有 2^32 个地址，整个 A 类地址空间共有 2^31 个地址
* B 类地址：`网络号(10 + 其余14位) + 主机号(16位)`
  * 可指派的网络号数 2^14 -1
  * 每一个网络上最大主机数是 2^16 - 2
* C 类地址：`网络号(110 + 其余21位) + 主机号(8位)`
* D 类地址：`1110 + 多播地址`
* E 类地址：`1111 + 保留为今后使用`
* IP 地址特点
  * 分等级的地址结构：分为两个等级即网络号和主机号
  * IP 地址管理机构在分配 IP 地址时只分配网络号，主机号则由得到该网络号的单位自行分配，方便管理
  * 路由器仅根据目的主机所连接的网络号来转发分组，不考虑主机号，减少了路由表中的项目数所占用的空间和查找时间

### IP 地址和硬件地址

* 硬件地址：是数据链路层和物理层使用的地址
* IP 地址：是网络层和以上各层使用的地址，是一种逻辑地址，通过软件实现
* IP 地址的IP数据报交给数据链路层后，被封装成了 MAC 帧。MAC 帧在传送时使用的源地址和目的地址都是硬件地址，这两个硬件地址都写在 MAC 帧的首部中
* IP 地址放在 IP 数据报的首部，硬件地址放在 MAC 帧的首部 

### 地址解析协议 ARP

* 用于解决通过机器的IP地址解析出其相应的硬件地址
* 在每台主机ARP高速缓存中存放一个从IP地址到硬件地址的映射表，并经常更新
* 原理
  * 主机A要向本局域网上的某台主机B发送IP数据报时，先在其ARP高速缓存中查看是否有B的IP地址
  * 有则直接查出对应的硬件地址，再将其写入 MAC 帧中
  * 否则，主机A自动运行ARP，该 ARP 进程在本地局域网上广播一个ARP请求，主要内容包括 A 主机的IP地址和硬件地址，以及想要获取硬件地址对应的主机的IP
  * 本地局域网上所有主机都会收到该条ARP请求
  * 只有主机B的IP地址和ARP的请求分组中要查询的IP一致，就收下该ARP请求分组并给予响应
  * 向主机A发送的ARP响应分组中包含主机B自己的硬件地址
  * 主机A收到B的ARP响应分组后，在其ARP高速缓存中写入主机B的IP地址到硬件地址的映射
  * 其实，主机B在收到主机A的ARP请求分组后，就把主机A的地址映射写入了主机B自己的高速缓存中
* ARP 对保存在高速缓存中的每一个映射地址项目都设置了生存时间，超过该设置时间的都会被删除掉
* 解决的仅仅是同一个局域网上的主机或者路由器的IP地址和硬件地址的映射问题
* ARP 协议会自动把IP地址解析为硬件地址

### IP 数据报的格式

* 首部 + 数据部分
* 首部的固定部分
  * 版本、首部长度、区分服务、总长度( 首部和数据之和的长度)、标识、标志、片偏移、生存时间、协议、首部检验和、源地址、目的地址
* IP 数据报首部的可变部分
  * 是一个选项字段

### IP 层转发分组的流程

* 是从一个路由器转发到下一个路由器
* 路由表中的主要信息是目的网络地址和下一跳地址
* 都是基于目的主机所在的网络
* 还可以采用默认路由以减少路由表的空间和查询路由表所用的时间
* 当路由器收到一个待转发的数据报并从路由表中获得下一跳路由器的IP地址后，将该IP地址送交给数据链路层的网络接口软件，它将负责把下一跳路由器的IP地址转换成硬件地址，并将其放入到链路层的MAC帧的首部，根据该硬件地址查找下一跳路由器

## 划分子网和构造超网

### 划分子网

* 从两级 IP 地址到三级 IP 地址
* IP 地址设计的缺陷
  * IP 地址空间利用率有时很低：申请到的各类地址网络未完全连接使用
  * 路由表太大而使网络性能变差：如果互联网中的网络数过大
  * 两级IP不够灵活：引入了子网号字段，使其变为三级 IP 地址。称之为划分子网、子网寻址或者子网路由选择
* 划分子网
  * 将一个拥有许多物理网络的单位划分为若干个子网，是一个单位内部的事情，对外仍表现为一个网络
  * 从网络的主机号借用几位作为子网号，主机号也就减少了同样的位数，从而在本单位内就变为了三级 IP 地址
  * 其他网络发过来的IP数据报，根据该IP数据报的目的网络号找到连接在本单位上的路由器，此路由器接收到后，按照网络号和子网号找到目的子网，把IP数据交付给目的主机
* 子网掩码
  * 路由油气在接收到数据报后，需要通过子网掩码才能转发到子网
  * 若一个网络不划分子网，该网络的子网掩码就使用默认子网掩码
  * 相邻路由器之间交换完信息之时，需要告诉彼此自己所在网络或者子网的子网掩码
  * 路由表中的每一个项目还需要记录子网掩码
* 使用子网时分组的转发
  * 使用子网划分后，路由表中主要含有目的网络地址、子网掩码、下一跳地址

### 无分类编址 CIDR（构造超网）

* 消除了传统的ABC类地址以及划分子网的概念，更加有效的分配IPv4的地址空间
* 把 32 位的 IP 地址划分为前后两个部分，前面部分为网络前缀，用于指明网络，后面部分用于指明主机
* 两级编址，但是无分类

## 网际控制报文协议 ICMP

* 为了更有效的转发 IP 数据报和提高交付成功的机会
* ICMP 报文作为 IP 层数据报的数据，加上数据报的首部，组成数据报文发送出去

### ICMP 报文的种类

* ICMP 差错报告报文
  * 终点不可达、时间超过、参数问题、改变路由( 重定向 )
* ICMP 询问报文
  * 回送请求和回答
  * 时间戳请求和回答
* 一个重要额应用就是 ping，用于测试两台主机之间的连通性。ping 使用了 ICMP 回送请求和回送回答报文

## 互联网的路由选择协议

* 通过一定的算法获得路由表中的各项目

### 基本概念

* 分层次的路由选择协议
* 自治系统 AS：把互联网划分为许多较小的自治系统。是在单一技术管理下的一组路由器，这些路由器使用自治系统内部的路由选择协议和共同的度量
* 一个AS对其他AS表现出的是一个单一的和一致的路由选择策略
* 互联网路由选择协议有两类
  * 内部网关协议：在一个自治系统内部使用的路由选择协议
  * 外部网关协议：源主机和目标主机不在一个自治系统内时，需要将路由选择信息传递到另一个自治系统
* 自治系统之间的路由选择为域间路由选择
* 自治系统内部的路由选择为域内路由选择

### 内部网关协议 RIP

* 工作原理
  * 基于距离向量的路由选择协议
  * 网络中的路由器要维护从它自己到其他每一个目的网络的距离记录，即距离向量
  * 跳数：即路由器之间的距离，每经过一个路由器，跳数加一
  * RIP 允许一条路径最多只能包含15个路由器，距离16即为不可达
  * RIP 只适用于小型网络
* 特点
  * 仅和相邻的路由器交换信息
  * 交换的信息是当前本路由器知道的所有信息
  * 按固定的时间间隔交换信息

### 内部网关协议 OSPF

* 特点
  * 开放最短路径优先 OSPF

### 路由器的构成

* 结构
  * 具有多个输入端口和多个输出端口的专用计算机，任务是转发分组
  * 路由器某个端口接收到分组，按照分组要去的目的地，将该分组从路由器的某个合适的端口转发给下一跳路由器，直到该分组到达终点
  * 路由器的转发分组是网络层的主要工作
  * 由路由选择和分组转发部分组成
  * 路由选择部分：即控制部分。核心构件是路由选择处理机，其任务是根据所选择的路由协议构造出路由表，同时经常或者定期的和相邻的路由器交换信息以不断更新维护路由表
  * 分组转发部分：交换结构、一组输入端口、一组输出端口
  * 交换结构根据转发表对分组进行处理，将某个输入端口进入的分组从另一个合适的输出端口转发出去

## IPv6

* 把地址从 IPv4 的 32 位增大到128 位。地址空间在可预见的将来是不会用完的

# 运输层

## 协议概述

### 进程之间的通信

* 向应用层提供通信服务
* 主机之间的通信实质是主机之间的应用进程之间的通信
* IP 协议把分组交付给了目的主机，但是只交给了主机的网络层，而没有交给主机中的应用进程
* 通信的真正端点是主机中的进程
* 运输层为应用进程之间提供端到端的逻辑通信，网络层为主机之间提供逻辑通信

### 运输层两个主要的协议

* 用户数据报协议：UDP。传输数据前不需要先建立连接
* 传输控制协议：TCP。传输数据前需要先建立连接，结束后释放连接

## 用户数据报协议 UDP

### 概述

* 在 IP 的数据报服务上加了复用、分用和差错检测的功能
* 无连接的：发送数据前不需要先建立连接，减少了开销和发送数据之前的延时
* 尽最大努力交付：不保证可靠交付
* 面向报文：发送方的 UDP 对应用程序交下来的报文，在添加首部后就交付给 IP 层，不拆分也不合并

### UDP 首部格式

* UDP 的两个字段：数据字段和首部字段
* UDP 校验和是把首部和数据部分一起都检验

## 传输控制协议 TCP

### 特点

* 面向连接的运输层协议

  * 应用程序在使用 TCP 协议之前需要先建立 TCP 连接，数据传输完成之后，释放已经建立好的连接

  * 每一条连接只能有两个端点，每一条 TCP 连接只能是点对点的
  * 提供可靠的交付服务，无差错、不丢失、不重复、且按顺序到达
  * 提供全双工通信：允许通信的双方在任何时候都能发送数据
  * 面向字节流，流是指流入到进程或者从进程流出的字节序列

* TCP 连接是虚连接即逻辑连接，而不是物理连接。TCP 报文段传送到IP层后，加上IP首部，再传送到数据链路层。再加上数据链路层的首部和尾部，才离开主机发送到物理链路

### TCP 的连接

* TCP 连接的端点叫套接字。套接字的表示方法是在点分十进制的 IP 地址后面加上端口号，中间使用冒号或者逗号隔开，如 192.3.4.5：80
* 每一条 TCP 连接唯一的被通信两端的两个端点即套接字所确定

## 可靠传输的工作原理

### 停止等待协议

* 每发送完一个分组就停止发送，等待对方确认，在收到确认后再发送下一个分组
* 传输过程出现差错时，需要重传前面发过的分组即为超时重传

## TCP 报文段的首部格式

* TCP 面向字节流，但是传输的数据单元却是报文段，分为首部和数据两部分

## TCP的运输连接管理

* 运输连接是用于传送 TCP 报文的
* 建立连接、数据传输、释放连接
* 建立连接需要解决
  * 是每一方能够感知对方的存在
  * 允许双方协商一些参数
  * 能够对运输实体资源进行分配
* 主动发起连接的为客户端、被动等待连接的是服务端

### TCP 的连接建立

* 建立的过程叫做握手，握手需要在客户和服务器之间交换三个 TCP 报文段
* 广为流行的译名为三次握手，其实是一次握手过程交换了三个报文。一次握手摇晃了三下
* A 向 B 发送请求，B 收到后对接收报文进行设置并返回给 A，A 收到后再次设置报文并返回给B，B 接收到A的确认后，进入已建立状态
* 在此过程中完成了三次报文的交换

### TCP 连接释放

* A 应用进程先向其 TCP 发送连接释放报文段并停止发送数据，主动关闭 TCP 连接，进入终止等待-1状态，等待B确认
* B 收到连接释放报文段后发出确认，进入关闭等待状态
* A 收到 B 的确认后，进入终止等待-2 状态，等待 B 发出的连接释放报文
* B 发送连接释放报文段，进入最后确认状态，等待 A 的确认
* A 收到 B 的连接释放报文段后，必须对此发出确认，进入时间等待状态
* TCP 连接释放是四报文握手

# 应用层

* 文本传输协议：FTP 
* 远程终端协议：TELNET
* 超文本传输协议：HTTP
  * 无连接的：交换HTTP报文之前，不需要先建立HTTP连接
  * 使用了面向连接的TCP作为运输层协议，以保证数据可靠性
  * 无状态的：服务器不记得是否访问过
* 电子邮件
  * SMTP：简单邮件传输协议



