# 了解 Web 及网络基础

## 使用 HTTP 协议访问 Web

* HTTP：超文本传输协议（超文本转移协议）
* Web 是建立在 HTTP 协议上通信的
* 通过浏览器客户端发送请求，向远程服务器获取资源，以显示 Web 页面

## HTTP 诞生于发展

* HTTP/0.9：问世于1990年
* HTTP/1.0：问世于1996，至今仍被广泛应用
* HTTP/1.1：问世于1997年1月，目前主流的协议版本
* HTTP/2.0：大幅度提升了 Web 的性能，减少了网络延迟 

## 网络基础 TCP/IP

* 通常使用的网络 是在 TCP/IP 协议族的基础上运行的，是 HTTP 协议内部的一个子集

### TCP/IP 协议族

* 协议：计算机与其他网络设备之间进行通信时事先约定好的规则。如何探测到通信目标、如何发起和接收通信等
* TCP/IP 是互联网相关的各类协议族的总称：TCP、IP、UDP、FTP、HTTP、PPPoE、DNS等

### TCP/IP 分层管理

* TCP/IP 协议族按层次分为4层：应用层、传输层、网络层、数据链路层（**TCP/IP四层网络模型**）
  * 注意：**OSI七层网络模型**为七层。物理层、数据链路层、网络层、传输层、会话层、表示层、应用层
* 应用层
  * 向用户提供应用服务时通信的活动。如 FTP 协议、DNS服务、HTTP协议 等
* 传输层
  * 提供处于网络连接中的两台**计算机之间**的数据传输
  * TCP 传输控制协议、UDP 用户数据报协议
* 网络层
  * 处理在网络上流动的数据包
  * 数据包是网络传输的最小数据单位
* 链路层
  * 处理网络连接的硬件部分
  * 控制操作系统、硬件的设备驱动、NIC 网络适配器即网卡、光纤等物理可见设备

### TCP/IP 通信传输流

* 利用 TCP/IP 协议族进行网络通信时，通信的两端都是按照分层的顺序进行的
* 发送数据端，从应用层开始由上向下进行数据传输。每经过一层都会在原数据上加上当前层的首部信息
* 接收数据端，从数据链路层开始由下向上进行数据接收。每经过一层，都会将之前层的头部信息删除掉
* 如，HTTP 数据由应用层发送到传输层，则会在传输层加上传输层的首部信息**TCP首部**，类似于盖了当地关卡的章。传到网络层需要加上**IP首部**，传到链路层需要加上**以太网首部**。接收时，逐层去掉。曰：对数据信息的封装

## 与HTTP关系密切的协议：IP、TCP、DNS

### IP 协议

* 网际协议。位于网络层，负责传输，将各种数据包传送给对方
* 需要满足两个条件：IP 地址和 MAC 地址，二者可以进行配对
* IP 地址：指明了节点被分配到的地址。可以改变
* MAC 地址：是指网卡所属的固定地址。基本不变
  * 网上设备位置的地址。唯一标识网卡，若有多个网卡，则每个网卡都需要髌骨会有一个唯一的MAC地址
  * 记录了下一跳的信息
* IP 间的通信依赖 MAC 地址。网络通信通常会经过多台计算机和路由器中转才能连接到对方
* 中转时，需要利用中转设备的 MAC 地址来搜索下一个中转目标，此时会用到 ARP 协议
* ARP 协议：地址解析协议。通过通信方的 IP 地址就可以反查出对应的 MAC 地址

### 确保可靠性的 TCP 协议

* 位于传输层，提供可靠的字节流服务

* 字节流服务：为方便传输，将大块数据分割成以**报文段**为单位的**数据包**进行管理

* TCP 能够确认数据最终是否传输到对方

* 为此，TCP 采用了三次握手策略。TCP 不会对传送后的情况置之不理，会向对方确认是否成功送达

* 握手过程中使用了TCP的标志：SYN 和 ACK

  ![image](https://github.com/rayest/Document/raw/master/images/三次握手.png)

* 发送端首先发送一个带 SYN 标志的数据包给对方，接收端收到后回传一个带有 SYN/ACK 标志的数据包给发送端以示消息接收到了。最后再由发送端回传一个带有 ACK 标志的数据包，以示握手结束
* 或曰："A：喂，听到我说话了吗?  B: 听到了，你能听到我说话吗？A：也能。好了，我们可以正常听话了。"
* 通过三次握手实现通信的可靠性

## DNS 服务

* 负责域名解析。同 HTTP 一样是位于应用层的协议。提供将域名映射到 IP 地址之间的解析服务

## URI 和 URL

* URI
  * 统一资源标识符
  * Uniform：规定统一的格式可以方便处理多种不同类型的资源
  * Resource：资源的定义是"任何可标识的东西"。可以是单一的，也可以是多数的集合体
  * Identifier：可标识的对象
  * 即由某个协议方案表示的资源的定位标识符，协议方案即指使用的协议类型名称。如 http、ftp、telnet、mailto等
  * URI 用字符串标识了某一个资源，而 URL 表示资源在互联网上的位置，URL 是 URI 的一个子集

# 简单的 HTTP 协议

## 通过请求和响应交换达成通信

* 请求报文：请求方法、请求URI、协议版本、可选的头部字段、内容实体
* 响应报文：协议版本、状态码、解释状态码的原因短语、可选的头部字段、实体主体

## 无状态协议

* 不保存状态。自身不对请求和响应之间的通信状态进行保存。不如鱼的七秒记忆
* 但是通过 cookie 技术可以管理状态。那 token 呢？

## HTTP 方法

* 略去

## 持久连接节省通信量

* HTTP 协议的初始版本中，每进行一次 HTTP 通信就要断开一次 TCP 连接
* 倘若请求频繁且每次请求的图片音视频等数据较大，此时无谓的 TCP 连接建立和断开增加了通信的开销

### 持久连接

* 解决 TCP 连接的问题
* HTTP/1.1 和 一部分 HTTP/1.0 想出了持久连接：HTTP keep-alive
* 只要一端没有明确提出断开连接，则保持 TCP 连接状态
* HTTP/1.1中，默认所有的连接都是持久连接

### 管线化

* 持久化使得多数请求以管线化方式发送成为可能
* 不用等待响应亦可以直接发送下一个请求
* 可以同时发送多个请求

## 使用 Cookie 的状态管理

* 在请求和响应报文中写入 cookie 信息来控制客户端状态
* 客户端保存从服务端发过来的响应报文首部信息 set-cookie 字段
* 并在下次请求服务端时自动在请求报文中加入 cookie 值
* 服务端接收后，检查该 cookie 值，得到之前的状态信息

# HTTP 报文信息

## HTTP 报文

* HTTP 报文：请求报文和响应报文
* HTTP 报文：报文首部和报文主体，二者通过**空行**来划分

## 报文结构

* 报文结构：请求或者响应报文首部、通用首部、实体首部、其他
  * 请求行：请求的方法、请求URI、HTTP 版本
  * 状态行：响应状态码、原因短语、HTTP 版本
  * 首部字段：请求和响应的各种条件和属性的各类首部
  * 其他

## 编码提升传输速率

* 在传输时编码，可以有效地处理大量的访问请求。编码需要程序端处理

### 报文主体和实体主体的差异

* 报文：是 HTTP 通信的基本单位
* 实体：作为请求和响应的有效载荷被传输。由实体首部和实体主体组成

### 压缩传输的内容编码

* 如：发送邮件选择附件时，为使邮件容量变小，会先使用 ZIP 压缩文件之后再添加附件进行发送
* HTTP 协议中有类似的被称为内容编码的功能，完成对内容的编码
* 内容编码需要指名对实体内容的编码格式，并保持实体信息原样压缩
* 客户端对接收到的内容实体进行解码
* 常见的编码格式：gzip、deflate、identity、compress等

### 分块传输编码

* 将实体主体数据分割成多块，以使浏览器逐步显示页面
* 每一块都会用十六进制标记块的大小，最后一块使用`0(CR+LF)`进行标记

## 发送多种数据的多部分对象集合

* 如：发送邮件时可以写入文字并添加图片附件，因为采用了 MIME 机制
* MIME ：多用途因特网邮件扩展。允许邮件处理文本、图片、视频等不同类型的数据
* Multipart：多部分对象集合，容纳多份不同类型的数据。multipart/form-data 等
* 需要设置 Content-type

## 获取部分内容的范围请求

* 如果下载文件失败，需要一种可恢复的机制，即从中断处恢复继续下载
* 需要指定下载的实体范围，即为范围请求
* 如：对一份 10 000 字节大小的资源，如果使用范围请求，可以只请求 5001 ~ 10 000 字节内的资源
* 需要请求使用首部字段Range 来指定资源的 byte 范围：`Range：bytes=5001-10000`
* 响应的状态码为 206 Partial Content
* 若服务器无法响应范围请求，则会返回 200 OK 和完整的实体内容

## 内容协商

* 如一个网站可能有多种语言版本，当浏览器默认为中文，访问相同的 URI 的 web 页面时，则会显示中文版的页面。即为内容协商
* 客户端和服务端进行资源内容的交涉，然后服务端提供给客户端最合适的资源
* 根据响应资源的语言、字符集、编码方式等作为判断的基准
* 请求首部：Accept、Accept-Charset、Accept-Encoding、Accept-Language、Content-Length 等
* 三种类型
  * 服务器驱动协商：以请求的首部作为参考，服务端进行处理
  * 客户端驱动协商：客户端对接收到的数据列表进行选择
  * 透明协商：服务器和客户端各自进行内容协商

# HTTP 状态码

* 