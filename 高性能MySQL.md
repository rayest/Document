# 高性能MySQL

## MySQL 基准测试

### sysbench

* Centos 和 Mac OS安装参考：`https://github.com/akopytov/sysbench`
* CPU 基准测试：
  * `sysbench --test=cpu --cpu-max-prime=20000 run`
    * 测试计算素数直到某个最大值所需要的时间

# 服务器性能剖析

## 性能优化简介

* 重要的原则：性能就是响应时间
* 就数据库而言，数据库服务器关注的任务是 SQL 语句执行所消耗的时间，即查询的响应时间
* 优化：可以说是尽可能地降低响应时间
* 资源：性能优化就是降低CPU利用率，以减少资源的使用，是一个误区。资源是用来消耗支撑工作的，故而较多资源投入使用，可以加快查询速度
* 吞吐量优化：提升每秒的查询量
* 找出查询消耗较多时间的原因，然后对症优化
* 合适的测量范围：只测量需要优化的活动
* 不合适的测量：
  * 在错误的时间启动和停止测量
  * 测量的是聚合后的信息，而非目标活动本身：抓住主要矛盾不放手

### 通过性能剖析进行优化

* 测量和分析消耗的时间主要方法
* 测量任务花费的时间、对结果进行统计和排序
* 安装 `https://www.cnblogs.com/zishengY/p/6852280.html`
* 执行时间：查询时间 + 等待时间。需要分别就出来并分别分析

### 理解性能剖析

* 判断哪些是值得优化的查询，没有回报的优化就放弃
* 异常情况：对执行频率较低，但是每次都慢，影响用户体验的要优化
* 未知的未知
  * 丢失的时间：任务执行的时间与测量到的时间之间的差值
  * 测量工具没有测量到某些任务、测量工具经度的问题
* 被掩藏的细节
  * 性能剖析只显示了平均时间的行为，无法显示所有的响应时间的分布
  * 需要额外的诸如：直方图、百分比、标准偏差等信息

## 对应用程序进行性能剖析

* 

